<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Emergency Command Center</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --primary: #2563eb;
  --danger: #dc2626;
  --warning: #f59e0b;
  --success: #16a34a;
  --bg: #f1f5f9;
  --dark: #020617;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Inter, sans-serif;
}

body {
  background: var(--bg);
}

/* LAYOUT */
.app {
  display: grid;
  grid-template-columns: 240px 1fr;
  height: 100vh;
}

/* SIDEBAR */
.sidebar {
  background: var(--dark);
  color: white;
  padding: 20px;
}

.sidebar h2 {
  font-size: 18px;
  margin-bottom: 30px;
}

.nav-btn {
  display: block;
  width: 100%;
  background: none;
  border: none;
  color: white;
  padding: 12px;
  text-align: left;
  cursor: pointer;
  border-radius: 8px;
  margin-bottom: 10px;
}

.nav-btn:hover,
.nav-btn.active {
  background: #1e293b;
}

/* MAIN */
.main {
  padding: 30px;
  overflow-y: auto;
}

/* HEADER */
.header {
  font-size: 22px;
  font-weight: 700;
  margin-bottom: 20px;
}

/* CARDS */
.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px,1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.card {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

.card h3 {
  font-size: 26px;
}

/* FORM */
.panel {
  background: white;
  padding: 25px;
  border-radius: 12px;
  max-width: 480px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
}

label {
  display: block;
  margin-top: 12px;
  font-weight: 600;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
}

button.primary {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
}

/* BADGES */
.badge {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 600;
  margin-top: 10px;
}

.LOW { background: var(--success); color: white; }
.MEDIUM { background: var(--warning); color: black; }
.HIGH { background: var(--danger); color: white; }

/* ALERT */
.alert {
  margin-top: 20px;
  padding: 14px;
  border-radius: 10px;
  background: var(--danger);
  color: white;
  display: none;
  font-weight: 700;
}

/* PAGES */
.page {
  display: none;
}

.page.active {
  display: block;
}
</style>
</head>

<body>

<div class="app">

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>ðŸš‘ Command Center</h2>
    <button class="nav-btn active" onclick="showPage('dashboard')">Dashboard</button>
    <button class="nav-btn" onclick="showPage('predict')">Predict Load</button>
    <button class="nav-btn" onclick="showPage('alerts')">Alerts</button>
  </div>

  <!-- MAIN -->
  <div class="main">

    <!-- DASHBOARD -->
    <div id="dashboard" class="page active">
      <div class="header">Dashboard Overview</div>
      <div class="cards">
        <div class="card">
          <h3 id="dAmb">â€”</h3>
          <span>Ambulances</span>
        </div>
        <div class="card">
          <h3 id="dPressure">â€”</h3>
          <span>Pressure</span>
        </div>
        <div class="card">
          <h3 id="dCity">â€”</h3>
          <span>City</span>
        </div>
      </div>
    </div>

    <!-- PREDICT -->
    <div id="predict" class="page">
      <div class="header">Run Prediction</div>
      <div class="panel">
        <label>City</label>
        <select id="city">
          <option>Pune</option>
          <option>Mumbai</option>
        </select>

        <label>Hour</label>
        <input type="number" id="hour" min="0" max="23">

        <label>Emergency Calls</label>
        <input type="number" id="calls">

        <button class="primary" onclick="predict()">Predict</button>

        <div id="badge"></div>
        <div class="alert" id="alert">ðŸš¨ CRITICAL ALERT</div>
      </div>
    </div>

    <!-- ALERTS -->
    <div id="alerts" class="page">
      <div class="header">System Alerts</div>
      <div class="card">
        Alerts appear automatically when pressure is HIGH.
      </div>
    </div>

  </div>
</div>

<script>
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(page).classList.add('active');

  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');
}

async function predict() {
    const btn = document.querySelector(".primary"); // the Predict button
    const cityValue = city.value;
    const hourValue = hour.value;
    const callsValue = calls.value;

    // Loading state
    btn.innerText = "Predicting...";
    btn.disabled = true;

    // Input validation
    if (!cityValue || hourValue === "" || callsValue === "") {
        alert("Please fill all fields");
        btn.innerText = "Predict";
        btn.disabled = false;
        return;
    }

    try {
        const res = await fetch(
            `http://127.0.0.1:8000/predict?city=${cityValue}&hour=${hourValue}&emergency_calls=${callsValue}`
        );

        if (!res.ok) throw new Error("Server error");

        const data = await res.json();

        // Update Dashboard Cards
        dAmb.innerText = data.predicted_ambulances;
        dPressure.innerText = data.pressure_level;
        dCity.innerText = data.city;

        // Update Badge
        badge.innerHTML = `<span class="badge ${data.pressure_level}">${data.pressure_level} PRESSURE</span>`;

        // Show Alert if HIGH
        alert.style.display = data.alert_triggered ? "block" : "none";

        // Navigate to Dashboard automatically
        showPage('dashboard');

    } catch (err) {
        alert("Prediction failed. Please try again.");
    } finally {
        btn.innerText = "Predict";
        btn.disabled = false;
    }
}

</script>

</body>
</html>
